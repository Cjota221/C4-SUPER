<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C4 Finan√ßas - Seu Controle Financeiro</title>
    
    <!-- Google Fonts: Poppins (Regular, Semi-Bold, Bold) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons for a modern look -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Chart.js for creating charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- All CSS styles are embedded here for single-file deployment -->
    <style>
        /* ------------------------- */
        /* --- RESET & VARIABLES --- */
        /* ------------------------- */
        :root {
            --primary-pink: #DB1472;
            --accent-yellow: #F8B81F;
            --bg-light: #f4f7fa;
            --bg-white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c9a;
            --border-color: #e6e9ed;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --font-main: 'Poppins', sans-serif;
            --border-radius: 12px; /* Global border radius */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            font-weight: 400; /* Poppins Normal */
            background-color: var(--bg-light);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
        }

        /* --------------------- */
        /* --- MAIN LAYOUT --- */
        /* --------------------- */
        .app-container { display: flex; min-height: 100vh; }

        .sidebar {
            width: 260px;
            background-color: var(--bg-white);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease-in-out;
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            z-index: 1000;
        }

        .sidebar-header { padding: 24px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid var(--border-color); }
        .logo { font-family: var(--font-main); font-size: 28px; font-weight: 700; color: var(--primary-pink); text-decoration: none; }
        .nav-menu { list-style: none; flex-grow: 1; padding-top: 20px; display: flex; flex-direction: column; }
        .nav-item a { display: flex; align-items: center; padding: 16px 24px; color: var(--text-light); text-decoration: none; font-weight: 600; transition: all 0.2s ease; gap: 16px; font-size: 16px; border-radius: 0 var(--border-radius) var(--border-radius) 0; margin-right: 12px;}
        .nav-item a:hover { background-color: var(--bg-light); color: var(--primary-pink); }
        .nav-item a.active { color: var(--primary-pink); background-color: #fceef6; border-right: 4px solid var(--primary-pink); }
        .nav-item i { font-size: 24px; }
        .nav-item.settings-item { border-top: 1px solid var(--border-color); padding-top: 8px; margin-top:auto; }
        .nav-item.profile-item { padding-bottom: 8px; }

        main.main-content { flex-grow: 1; padding: 24px; transition: margin-left 0.3s ease-in-out; margin-left: 0; }
        .main-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
        .page-title { font-weight: 700; font-size: 28px; }
        .mobile-menu-toggle { display: block; background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-dark); z-index: 1001; }

        .page-view { display: none; }
        .page-view.active { display: block; }

        /* ------------------------ */
        /* --- GENERIC COMPONENTS --- */
        /* ------------------------ */
        .card { background-color: var(--bg-white); border-radius: var(--border-radius); padding: 24px; box-shadow: var(--shadow); margin-bottom: 24px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 16px; flex-wrap: wrap; }
        .card-header-content { flex-grow: 1; }
        .card-title { font-weight: 600; font-size: 18px; }
        .info-text { font-size: 13px; color: var(--text-light); font-weight: 400; margin-top: 4px; max-width: 90%; }
        
        .btn { padding: 12px 24px; border-radius: var(--border-radius); border: none; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background-color: var(--primary-pink); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(219, 20, 114, 0.3); }
        .btn-secondary { background-color: var(--bg-light); color: var(--text-dark); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background-color: var(--border-color); }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { opacity: 0.9; }
        .btn-icon { padding: 8px; line-height: 1; border-radius: 50%; } /* For circular icon buttons */
        
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .kpi-card { background-color: var(--bg-white); border-radius: var(--border-radius); padding: 20px; box-shadow: var(--shadow); display: flex; flex-direction: column; gap: 8px; }
        .kpi-card .icon { font-size: 28px; padding: 12px; border-radius: 50%; display: inline-flex; margin-bottom: 12px; }
        .kpi-card .icon.revenue { color: var(--success-color); background-color: #e9f7ef; }
        .kpi-card .icon.profit { color: var(--accent-yellow); background-color: #fef8e8; }
        .kpi-card .icon.expenses { color: var(--danger-color); background-color: #fcebec; }
        .kpi-card .icon.balance { color: var(--primary-pink); background-color: #fceef6; }
        .kpi-card .icon.stock { color: var(--primary-pink); background-color: #fceef6; }
        .kpi-label { font-size: 14px; color: var(--text-light); font-weight: 600; }
        .kpi-value { font-weight: 700; font-size: 26px; }

        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 16px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        .data-table th { font-weight: 600; font-size: 14px; color: var(--text-light); text-transform: uppercase; }
        .data-table td { font-size: 15px; }

        .status-badge { padding: 4px 12px; border-radius: 16px; font-weight: 600; font-size: 12px; }
        .status-badge.paid { color: var(--success-color); background-color: #e9f7ef; }
        .status-badge.pending { color: var(--accent-yellow); background-color: #fef8e8; }
        
        .actions-cell button { background: none; border: none; cursor: pointer; color: var(--text-light); padding: 4px; border-radius: 50%; width: 32px; height: 32px; display: inline-flex; justify-content: center; align-items: center;}
        .actions-cell button:hover { color: var(--text-dark); background-color: var(--bg-light); }
        .actions-cell i { font-size: 20px; }

        /* --- MODAL STYLES --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; overflow-y: auto; padding: 20px 0;}
        .modal.is-open { display: flex; }
        .modal-content { background: var(--bg-white); padding: 32px; border-radius: var(--border-radius); width: 90%; max-width: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-weight: 700; font-size: 22px; }
        .close-modal { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-light); }
        .form-group { display: flex; flex-direction: column; margin-bottom: 16px;}
        .form-group label { margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        .form-group input, .form-group textarea { padding: 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius); outline: none; width: 100%; font-family: var(--font-main); }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .modal-footer { margin-top: 24px; display: flex; justify-content: flex-end; gap: 12px; }

        /* --- PAGE SPECIFIC --- */
        #despesas .grid-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; }
        #expenses-chart-container { position: relative; height: 300px; }
        #produtos .page-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 16px; }
        #produtos .search-bar { display: flex; align-items: center; background-color: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 0 8px; flex-grow: 1; max-width: 400px;}
        #produtos .search-bar i { color: var(--text-light); }
        #produtos .search-bar input { border: none; outline: none; padding: 12px 8px; background: transparent; width: 100%; }
        #produtos .header-actions { display: flex; gap: 12px; }

        /* --- ADD PRODUCT MODAL --- */
        #add-product-modal .modal-content { max-width: 800px; }
        #add-product-modal .form-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 24px; }
        #add-product-modal .photo-uploader { grid-row: 1 / 4; }
        #product-photo-upload { display: none; }
        #product-photo-label { display: flex; align-items: center; justify-content: center; width: 100%; height: 200px; border: 2px dashed var(--border-color); border-radius: var(--border-radius); cursor: pointer; flex-direction: column; color: var(--text-light); }
        #product-photo-label img { width: 100%; height: 100%; object-fit: cover; border-radius: var(--border-radius); }
        
        .variation-type-selector { display: flex; gap: 10px; flex-wrap: wrap; background-color: var(--bg-light); padding: 8px; border-radius: var(--border-radius); margin: 10px 0; }
        .variation-type-selector label { display: flex; align-items: center; gap: 8px; padding: 8px 12px; cursor: pointer; border-radius: var(--border-radius); }
        .variation-type-selector input { display: none; }
        .variation-type-selector input:checked + label { background-color: var(--primary-pink); color: white; box-shadow: 0 2px 4px rgba(219, 20, 114, 0.3); }

        .calculator-section { background: var(--bg-light); border-radius: var(--border-radius); padding: 20px; margin-top: 20px; }
        .cost-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .other-cost-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center;}
        .other-cost-row input { flex: 1; }
        #profit-slider-container { display: flex; align-items: center; gap: 15px; margin-top: 10px;}
        #profit-slider { flex: 1; -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: var(--border-color); border-radius: 5px; outline: none; }
        #profit-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--primary-pink); border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.2);}
        #profit-slider::-moz-range-thumb { width: 20px; height: 20px; background: var(--primary-pink); border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.2);}
        #profit-percentage-label { font-weight: bold; color: var(--primary-pink); font-size: 1.1em;}

        .pricing-result-panel { background-color: #fceef6; border: 2px solid var(--primary-pink); border-radius: var(--border-radius); padding: 20px; margin-top: 20px; }
        .pricing-result-header { font-weight: 700; text-align: center; margin-bottom: 15px; }
        .pricing-result-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; }
        .result-item-label { font-size: 13px; font-weight: 600; color: var(--text-light); }
        .result-item-value { font-size: 22px; font-weight: 700; color: var(--text-dark); }

        /* --- RESPONSIVENESS --- */
        @media (max-width: 1200px) {
            #despesas .grid-layout { grid-template-columns: 1fr; }
        }
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.is-open { transform: translateX(0); box-shadow: 0 0 40px rgba(0,0,0,0.1); }
            main.main-content { margin-left: 0; width: 100%; }
            #add-product-modal .form-grid { grid-template-columns: 1fr; }
        }
        @media (min-width: 993px) {
            .mobile-menu-toggle { display: none; }
            .sidebar { transform: translateX(0); position: relative; }
            main.main-content { margin-left: 0; }
            .app-container { display: flex; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header"><a href="#" class="logo">C4</a></div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link active" data-target="dashboard"><i class="ph-bold ph-gauge"></i> Dashboard</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="produtos"><i class="ph-bold ph-package"></i> Produtos</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="vendas"><i class="ph-bold ph-shopping-cart-simple"></i> Vendas</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="despesas"><i class="ph-bold ph-receipt"></i> Despesas</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="clientes"><i class="ph-bold ph-users"></i> Clientes</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="planejamento"><i class="ph-bold ph-flag-checkered"></i> Planejamento</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="gamificacao"><i class="ph-bold ph-trophy"></i> Gamifica√ß√£o</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-target="estoque"><i class="ph-bold ph-stack"></i> Produ√ß√£o e Estoque</a></li>
                <li class="nav-item settings-item"><a href="#" class="nav-link" data-target="configuracoes"><i class="ph-bold ph-gear"></i> Configura√ß√µes</a></li>
                <li class="nav-item profile-item"><a href="#" class="nav-link" data-target="perfil"><i class="ph-bold ph-user-circle"></i> Perfil</a></li>
            </ul>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="main-header">
                <button class="mobile-menu-toggle" id="menu-toggle"><i class="ph ph-list"></i></button>
                <h1 class="page-title" id="page-title-header">Dashboard</h1>
            </header>

            <!-- ======================= -->
            <!-- === DASHBOARD VIEW  === -->
            <!-- ======================= -->
            <div id="dashboard" class="page-view active">
                 <div class="kpi-grid">
                    <div class="kpi-card"><span class="icon revenue"><i class="ph-bold ph-trend-up"></i></span><span class="kpi-label">Receita Total (M√™s)</span><span class="kpi-value">R$ 7.850,00</span></div>
                    <div class="kpi-card"><span class="icon profit"><i class="ph-bold ph-smiley"></i></span><span class="kpi-label">Lucro (M√™s)</span><span class="kpi-value">R$ 3.120,50</span></div>
                    <div class="kpi-card"><span class="icon expenses"><i class="ph-bold ph-trend-down"></i></span><span class="kpi-label">Despesas (M√™s)</span><span class="kpi-value">R$ 4.729,50</span></div>
                    <div class="kpi-card"><span class="icon balance"><i class="ph-bold ph-wallet"></i></span><span class="kpi-label">Saldo Atual</span><span class="kpi-value">R$ 12.345,67</span></div>
                </div>
                <div class="card">
                    <div class="card-header"><div class="card-header-content"><h2 class="card-title">√öltimas Vendas</h2></div><button class="btn btn-primary">Nova Venda</button></div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead><tr><th>Cliente</th><th>Valor</th><th>Data</th><th>Status</th></tr></thead>
                            <tbody>
                                <tr><td>Ana Silva</td><td>R$ 150,00</td><td>Hoje</td><td><span class="status-badge paid">Pago</span></td></tr>
                                <tr><td>Carlos Souza</td><td>R$ 89,90</td><td>Ontem</td><td><span class="status-badge paid">Pago</span></td></tr>
                                <tr><td>Mariana Costa</td><td>R$ 320,00</td><td>H√° 2 dias</td><td><span class="status-badge pending">Pendente</span></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- ======================= -->
            <!-- === PRODUCTS VIEW === -->
            <!-- ======================= -->
            <div id="produtos" class="page-view">
                <!-- KPI Summary for Products -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <span class="icon balance"><i class="ph-bold ph-coins"></i></span>
                        <span class="kpi-label">Valor Total do Estoque</span>
                        <span class="kpi-value" id="stock-value-total">R$ 0,00</span>
                    </div>
                     <div class="kpi-card">
                        <span class="icon profit"><i class="ph-bold ph-chart-line-up"></i></span>
                        <span class="kpi-label">Lucro Potencial do Estoque</span>
                        <span class="kpi-value" id="stock-profit-potential">R$ 0,00</span>
                    </div>
                     <div class="kpi-card">
                        <span class="icon stock"><i class="ph-bold ph-stack"></i></span>
                        <span class="kpi-label">Quantidade Total em Estoque</span>
                        <span class="kpi-value" id="stock-quantity-total">0</span>
                    </div>
                </div>

                <div class="card">
                    <div class="page-header card-header">
                        <div class="search-bar">
                            <i class="ph ph-magnifying-glass"></i>
                            <input type="text" id="product-search-input" placeholder="Buscar produto...">
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary"><i class="ph-bold ph-upload-simple"></i> Importar</button>
                            <button class="btn btn-primary" id="add-product-btn"><i class="ph-bold ph-plus"></i> Adicionar Produto</button>
                        </div>
                    </div>
                    <div class="card-body" style="padding:0;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Categoria</th>
                                    <th>Pre√ßo Venda</th>
                                    <th>Custo</th>
                                    <th>Estoque</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">
                                <!-- Products will be rendered here by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- === EXPENSES VIEW === -->
            <!-- ======================= -->
            <div id="despesas" class="page-view">
                <div class="kpi-grid">
                    <div class="kpi-card"><span class="icon expenses"><i class="ph-bold ph-receipt"></i></span><span class="kpi-label">Total de Despesas</span><span class="kpi-value" id="expenses-summary-total">R$ 0,00</span></div>
                    <div class="kpi-card"><span class="icon balance"><i class="ph-bold ph-currency-circle-dollar"></i></span><span class="kpi-label">Custo Unit√°rio Total</span><span class="kpi-value" id="expenses-summary-unit-cost">R$ 0,00</span></div>
                    <div class="kpi-card"><span class="icon profit"><i class="ph-bold ph-list-numbers"></i></span><span class="kpi-label">Total de Lan√ßamentos</span><span class="kpi-value" id="expenses-summary-count">0</span></div>
                </div>
                <div class="grid-layout">
                    <div class="left-column">
                        <div class="card">
                            <div class="card-header"><div class="card-header-content"><h2 class="card-title">Despesas Fixas</h2><p class="info-text">Custos que n√£o mudam, independentemente do volume de vendas.</p></div><button class="btn btn-primary" id="add-fixed-expense-btn"><i class="ph-bold ph-plus"></i> Adicionar</button></div>
                            <table class="data-table"><thead><tr><th>Nome</th><th>Valor</th><th>Vencimento</th><th>A√ß√µes</th></tr></thead><tbody id="fixed-expenses-table"></tbody></table>
                        </div>
                        <div class="card">
                            <div class="card-header"><div class="card-header-content"><h2 class="card-title">Despesas Vari√°veis</h2><p class="info-text">Custos que variam de acordo com o volume de produ√ß√£o ou vendas.</p></div><button class="btn btn-primary" id="add-variable-expense-btn"><i class="ph-bold ph-plus"></i> Adicionar</button></div>
                            <table class="data-table"><thead><tr><th>Nome</th><th>Valor</th><th>A√ß√µes</th></tr></thead><tbody id="variable-expenses-table"></tbody></table>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="card">
                            <div class="card-header"><div class="card-header-content"><h2 class="card-title">Custo do Frete</h2><p class="info-text">Valor total gasto com frete por m√™s para receber produtos/insumos.</p></div></div>
                            <div class="form-group"><label for="frete-custo">Valor m√©dio mensal (R$)</label><input type="number" id="frete-custo" placeholder="0,00" value="150.00"></div>
                        </div>
                        <div class="card">
                            <div class="card-header"><div class="card-header-content"><h2 class="card-title">C√°lculo de Custo</h2><p class="info-text">A m√©dia de itens vendidos por m√™s. Crucial para o custo unit√°rio.</p></div></div>
                            <div class="form-group"><label for="produtos-vendidos">Quantidade de produtos vendidos/m√™s</label><input type="number" id="produtos-vendidos" placeholder="0" value="200"></div>
                        </div>
                        <div class="card">
                            <div class="card-header"><div class="card-header-content"><h2 class="card-title">Distribui√ß√£o de Despesas</h2><p class="info-text">Veja visualmente como seus custos est√£o divididos.</p></div></div>
                            <div id="expenses-chart-container"><canvas id="expenses-chart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other placeholders -->
            <div id="vendas" class="page-view"><div class="card"><h2 class="card-title">Gest√£o de Vendas</h2><p>Interface em constru√ß√£o.</p></div></div>
            <div id="clientes" class="page-view"><div class="card"><h2 class="card-title">Gest√£o de Clientes (CRM)</h2><p>Interface em constru√ß√£o.</p></div></div>
            <div id="planejamento" class="page-view"><div class="card"><h2 class="card-title">Planejamento Financeiro</h2><p>Interface em constru√ß√£o.</p></div></div>
            <div id="gamificacao" class="page-view"><div class="card"><h2 class="card-title">Gamifica√ß√£o</h2><p>Interface em constru√ß√£o.</p></div></div>
            <div id="estoque" class="page-view"><div class="card"><h2 class="card-title">Produ√ß√£o e Estoque</h2><p>Interface em constru√ß√£o.</p></div></div>
            <div id="configuracoes" class="page-view"><div class="card"><h2 class="card-title">Configura√ß√µes Gerais</h2><p>Interface em constru√ß√£o.</p></div></div>
            <div id="perfil" class="page-view"><div class="card"><h2 class="card-title">Perfil do Usu√°rio</h2><p>Interface em constru√ß√£o.</p></div></div>
        </main>
    </div>

    <!-- Modals -->
    <div id="expense-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="expense-modal-title" class="modal-title">Adicionar Despesa</h2>
                <button id="expense-close-modal-btn" class="close-modal"><i class="ph ph-x"></i></button>
            </div>
            <form id="expense-form">
                <input type="hidden" id="expense-id">
                <input type="hidden" id="expense-type">
                <div class="form-group">
                    <label for="expense-name">Nome da Despesa</label>
                    <input type="text" id="expense-name" required>
                </div>
                <div class="form-group">
                    <label for="expense-value">Valor (R$)</label>
                    <input type="number" id="expense-value" step="0.01" required>
                </div>
                <div class="form-group" id="expense-due-date-group">
                    <label for="expense-due-date">Data de Vencimento</label>
                    <input type="date" id="expense-due-date">
                </div>
                <div class="modal-footer">
                    <button type="button" id="expense-cancel-btn" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Despesa</button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirmation-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmation-title" class="modal-title">Confirmar Exclus√£o</h2>
            </div>
            <p id="confirmation-message">Tem certeza de que deseja excluir este item? Esta a√ß√£o n√£o pode ser desfeita.</p>
            <div class="modal-footer">
                <button type="button" id="confirmation-cancel-btn" class="btn btn-secondary">Cancelar</button>
                <button type="button" id="confirmation-confirm-btn" class="btn btn-danger">Excluir</button>
            </div>
        </div>
    </div>

    <div id="add-product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar Produto</h2>
                <button id="add-product-close-btn" class="close-modal"><i class="ph ph-x"></i></button>
            </div>
            <form id="add-product-form">
                <div class="form-grid">
                    <div class="form-group photo-uploader">
                        <label for="product-photo-upload">Foto do Produto</label>
                        <label for="product-photo-upload" id="product-photo-label">
                            <i class="ph-fill ph-camera" style="font-size: 48px;"></i>
                            <span>Clique para adicionar</span>
                        </label>
                        <input type="file" id="product-photo-upload" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="product-name">Nome do Produto</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="product-description">Descri√ß√£o</label>
                        <textarea id="product-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-base-cost">Pre√ßo de Custo do Produto (R$)</label>
                        <input type="number" id="product-base-cost" step="0.01" required>
                    </div>
                </div>
                 <div class="variation-type-selector">
                    <input type="radio" id="var-none" name="variation-type" value="none" checked><label for="var-none">Sem Varia√ß√£o</label>
                    <input type="radio" id="var-simple" name="variation-type" value="simple"><label for="var-simple">Simples</label>
                    <input type="radio" id="var-combined" name="variation-type" value="combined"><label for="var-combined">Combinada</label>
                </div>

                <div class="calculator-section">
                    <h3 class="card-title" style="margin-bottom: 15px;">Calculadora Inteligente de Pre√ßo</h3>
                    <div class="cost-item"><span>Custo do Produto</span><strong id="calc-base-cost">R$ 0,00</strong></div>
                    <div class="cost-item"><span>Custo Unit√°rio (Despesas)</span><strong id="calc-unit-expense">R$ 0,00</strong></div>
                    <hr style="border:none; border-top: 1px dashed var(--border-color); margin: 10px 0;">
                    <div class="cost-item"><strong>Custo Total Base</strong><strong id="calc-total-base-cost">R$ 0,00</strong></div>
                    <div id="other-costs-section" style="margin-top: 15px;">
                        <label>Outros Custos (%)</label>
                        <div id="other-costs-container"></div>
                        <button type="button" id="add-other-cost-btn" class="btn btn-secondary" style="margin-top: 10px; width: 100%;"><i class="ph ph-plus"></i> Adicionar Custo %</button>
                    </div>
                    <div style="margin-top: 20px;">
                        <label>Margem de Lucro Desejada</label>
                        <div id="profit-slider-container">
                            <input type="range" id="profit-slider" min="0" max="200" value="50">
                            <span id="profit-percentage-label">50%</span>
                        </div>
                    </div>
                </div>

                <div class="pricing-result-panel">
                    <h3 class="pricing-result-header">Pre√ßo Final Sugerido</h3>
                    <div class="pricing-result-grid">
                        <div><div class="result-item-label">Pre√ßo de Venda</div><div class="result-item-value" id="final-price-value">R$ 0,00</div></div>
                        <div><div class="result-item-label">Lucro Previsto</div><div class="result-item-value" id="final-profit-value">R$ 0,00</div></div>
                        <div><div class="result-item-label">Margem</div><div class="result-item-value" id="final-margin-value">0%</div></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="product-cancel-btn" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- GLOBAL STATE ---
            let appState = {
                custoUnitarioTotal: 0
            };

            // --- GENERAL APP NAVIGATION ---
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const navLinks = document.querySelectorAll('.nav-link');
            const pageViews = document.querySelectorAll('.page-view');
            const pageTitleHeader = document.getElementById('page-title-header');

            menuToggle.addEventListener('click', () => sidebar.classList.toggle('is-open'));
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    switchView(targetId);
                    updateActiveLink(link);
                    if (window.innerWidth <= 992) sidebar.classList.remove('is-open');
                });
            });

            function switchView(viewId) {
                pageViews.forEach(view => view.classList.remove('active'));
                const targetView = document.getElementById(viewId);
                if (targetView) targetView.classList.add('active');
            }

            function updateActiveLink(activeLink) {
                navLinks.forEach(link => link.classList.remove('active'));
                activeLink.classList.add('active');
                pageTitleHeader.textContent = activeLink.textContent.trim();
            }

            function formatCurrency(value) {
                return `R$ ${value.toFixed(2).replace('.', ',')}`;
            }

            // --- EXPENSES PAGE LOGIC ---
            const expensesLogic = () => {
                let fixedExpensesData = [{ id: 1, name: 'Aluguel', value: 1200.00, due: '2025-07-10' }, { id: 2, name: 'Internet', value: 99.90, due: '2025-07-15' }, { id: 3, name: 'Plano de Celular', value: 50.00, due: '2025-07-20' }];
                let variableExpensesData = [{ id: 1, name: 'Embalagens', value: 250.00 }, { id: 2, name: 'Marketing', value: 300.00 }];
                const fixedTable = document.getElementById('fixed-expenses-table');
                const variableTable = document.getElementById('variable-expenses-table');
                const freteInput = document.getElementById('frete-custo');
                const vendidosInput = document.getElementById('produtos-vendidos');
                const totalDespesasEl = document.getElementById('expenses-summary-total');
                const custoUnitarioEl = document.getElementById('expenses-summary-unit-cost');
                const totalCountEl = document.getElementById('expenses-summary-count');
                const addFixedBtn = document.getElementById('add-fixed-expense-btn');
                const addVariableBtn = document.getElementById('add-variable-expense-btn');
                const expenseModal = document.getElementById('expense-modal');
                const expenseModalTitle = document.getElementById('expense-modal-title');
                const expenseCloseModalBtn = document.getElementById('expense-close-modal-btn');
                const expenseCancelBtn = document.getElementById('expense-cancel-btn');
                const expenseForm = document.getElementById('expense-form');
                const expenseIdInput = document.getElementById('expense-id');
                const expenseNameInput = document.getElementById('expense-name');
                const expenseValueInput = document.getElementById('expense-value');
                const expenseDueDateInput = document.getElementById('expense-due-date');
                const expenseDueDateGroup = document.getElementById('expense-due-date-group');
                const expenseTypeInput = document.getElementById('expense-type');
                const confirmationModal = document.getElementById('confirmation-modal');
                const confirmBtn = document.getElementById('confirmation-confirm-btn');
                const cancelConfirmBtn = document.getElementById('confirmation-cancel-btn');
                const ctx = document.getElementById('expenses-chart').getContext('2d');
                let expensesChart;

                function formatDate(dateString) { if (!dateString) return 'N/A'; const [y, m, d] = dateString.split('-'); return `${d}/${m}/${y}`; }
                function renderFixedExpenses() { if (!fixedTable) return; fixedTable.innerHTML = ''; fixedExpensesData.forEach(item => { const r = fixedTable.insertRow(); r.innerHTML = `<td>${item.name}</td><td>${formatCurrency(item.value)}</td><td>${formatDate(item.due)}</td><td class="actions-cell"><button class="edit-btn" data-id="${item.id}" data-type="fixed" title="Editar"><i class="ph ph-pencil-simple"></i></button><button class="delete-btn" data-id="${item.id}" data-type="fixed" title="Excluir"><i class="ph ph-trash"></i></button></td>`; }); }
                function renderVariableExpenses() { if (!variableTable) return; variableTable.innerHTML = ''; variableExpensesData.forEach(item => { const r = variableTable.insertRow(); r.innerHTML = `<td>${item.name}</td><td>${formatCurrency(item.value)}</td><td class="actions-cell"><button class="edit-btn" data-id="${item.id}" data-type="variable" title="Editar"><i class="ph ph-pencil-simple"></i></button><button class="delete-btn" data-id="${item.id}" data-type="variable" title="Excluir"><i class="ph ph-trash"></i></button></td>`; }); }
                function calculateCosts() { const f = fixedExpensesData.reduce((a, i) => a + i.value, 0); const v = variableExpensesData.reduce((a, i) => a + i.value, 0); const c = parseFloat(freteInput.value) || 0; const t = f + v + c; const p = parseInt(vendidosInput.value) || 0; const u = p > 0 ? t / p : 0; appState.custoUnitarioTotal = u; const n = fixedExpensesData.length + variableExpensesData.length; totalDespesasEl.textContent = formatCurrency(t); custoUnitarioEl.textContent = formatCurrency(u); totalCountEl.textContent = n; updateChart(f, v, c); }
                function updateChart(f, v, c) { if (expensesChart) { expensesChart.data.datasets[0].data = [f, v, c]; expensesChart.update(); } }
                function createChart() { if (expensesChart) expensesChart.destroy(); if(!ctx) return; expensesChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Fixas', 'Vari√°veis', 'Frete'], datasets: [{ data: [0, 0, 0], backgroundColor: ['rgba(219, 20, 114, 0.7)', 'rgba(248, 184, 31, 0.7)', 'rgba(44, 62, 80, 0.7)'], borderColor: ['#DB1472', '#F8B81F', '#2c3e50'], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } }); }
                function openExpenseModal(type, id = null) { expenseForm.reset(); expenseTypeInput.value = type; expenseIdInput.value = id || ''; const isEdit = id !== null; const arr = type === 'fixed' ? fixedExpensesData : variableExpensesData; const item = isEdit ? arr.find(d => d.id === id) : null; expenseModalTitle.textContent = isEdit ? 'Editar Despesa' : 'Adicionar Despesa'; expenseNameInput.value = item ? item.name : ''; expenseValueInput.value = item ? item.value : ''; if (type === 'fixed') { expenseDueDateGroup.style.display = 'block'; expenseDueDateInput.value = item ? item.due : ''; } else { expenseDueDateGroup.style.display = 'none'; } expenseModal.classList.add('is-open'); }
                function closeExpenseModal() { expenseModal.classList.remove('is-open'); }
                function handleFormSubmit(e) { e.preventDefault(); const id = parseInt(expenseIdInput.value); const type = expenseTypeInput.value; const arr = type === 'fixed' ? fixedExpensesData : variableExpensesData; const data = { id: id || Date.now(), name: expenseNameInput.value, value: parseFloat(expenseValueInput.value), due: expenseDueDateInput.value }; if (id) { const i = arr.findIndex(d => d.id === id); if (i > -1) arr[i] = data; } else { arr.push(data); } if (type === 'fixed') renderFixedExpenses(); else renderVariableExpenses(); calculateCosts(); closeExpenseModal(); }
                function openConfirmation(onConfirm) { confirmationModal.classList.add('is-open'); confirmBtn.onclick = () => { onConfirm(); closeConfirmation(); }; }
                function closeConfirmation() { confirmationModal.classList.remove('is-open'); }
                function handleDelete(id, type) { openConfirmation(() => { if (type === 'fixed') { fixedExpensesData = fixedExpensesData.filter(d => d.id !== id); renderFixedExpenses(); } else { variableExpensesData = variableExpensesData.filter(d => d.id !== id); renderVariableExpenses(); } calculateCosts(); }); }
                freteInput.addEventListener('input', calculateCosts); vendidosInput.addEventListener('input', calculateCosts); addFixedBtn.addEventListener('click', () => openExpenseModal('fixed')); addVariableBtn.addEventListener('click', () => openExpenseModal('variable')); expenseCloseModalBtn.addEventListener('click', closeExpenseModal); expenseCancelBtn.addEventListener('click', closeExpenseModal); expenseModal.addEventListener('click', (e) => { if (e.target === expenseModal) closeExpenseModal(); }); expenseForm.addEventListener('submit', handleFormSubmit); cancelConfirmBtn.addEventListener('click', closeConfirmation); confirmationModal.addEventListener('click', (e) => { if (e.target === confirmationModal) closeConfirmation(); });
                [fixedTable, variableTable].forEach(table => { table.addEventListener('click', (e) => { const eb = e.target.closest('.edit-btn'); const db = e.target.closest('.delete-btn'); if (eb) { const id = parseInt(eb.dataset.id); const type = eb.dataset.type; openExpenseModal(type, id); } if (db) { const id = parseInt(db.dataset.id); const type = db.dataset.type; handleDelete(id, type); } }); });
                createChart(); renderFixedExpenses(); renderVariableExpenses(); calculateCosts();
            };
            
            // --- PRODUCTS PAGE LOGIC ---
            const productsLogic = () => {
                const addProductBtn = document.getElementById('add-product-btn');
                const addProductModal = document.getElementById('add-product-modal');
                const addProductCloseBtn = document.getElementById('add-product-close-btn');
                const productCancelBtn = document.getElementById('product-cancel-btn');
                
                addProductBtn.addEventListener('click', () => {
                    document.getElementById('calc-unit-expense').textContent = formatCurrency(appState.custoUnitarioTotal);
                    updatePricingCalculator(); 
                    addProductModal.classList.add('is-open');
                });
                addProductCloseBtn.addEventListener('click', () => addProductModal.classList.remove('is-open'));
                productCancelBtn.addEventListener('click', () => addProductModal.classList.remove('is-open'));
                
                const productBaseCostInput = document.getElementById('product-base-cost');
                const profitSlider = document.getElementById('profit-slider');
                const otherCostsContainer = document.getElementById('other-costs-container');
                const addOtherCostBtn = document.getElementById('add-other-cost-btn');

                function updatePricingCalculator() {
                    const baseCost = parseFloat(productBaseCostInput.value) || 0;
                    const unitExpense = appState.custoUnitarioTotal;
                    const totalBaseCost = baseCost + unitExpense;

                    document.getElementById('calc-base-cost').textContent = formatCurrency(baseCost);
                    document.getElementById('calc-total-base-cost').textContent = formatCurrency(totalBaseCost);

                    let totalOtherPercentage = 0;
                    document.querySelectorAll('.other-cost-row input[type="number"]').forEach(input => {
                        totalOtherPercentage += parseFloat(input.value) || 0;
                    });
                    
                    if (totalOtherPercentage >= 100) { totalOtherPercentage = 99.9; }

                    const costAfterPercentages = totalBaseCost / (1 - (totalOtherPercentage / 100));

                    const profitMargin = parseFloat(profitSlider.value);
                    document.getElementById('profit-percentage-label').textContent = `${profitMargin.toFixed(0)}%`;
                    
                    const finalPrice = costAfterPercentages / (1 - (profitMargin / 100));
                    const finalProfit = finalPrice - costAfterPercentages;
                    const finalMargin = finalPrice > 0 ? (finalProfit / finalPrice) * 100 : 0;
                    
                    document.getElementById('final-price-value').textContent = formatCurrency(finalPrice);
                    document.getElementById('final-profit-value').textContent = formatCurrency(finalProfit);
                    document.getElementById('final-margin-value').textContent = `${finalMargin.toFixed(1)}%`;
                }
                
                productBaseCostInput.addEventListener('input', updatePricingCalculator);
                profitSlider.addEventListener('input', updatePricingCalculator);
                otherCostsContainer.addEventListener('input', updatePricingCalculator);

                addOtherCostBtn.addEventListener('click', () => {
                    const row = document.createElement('div');
                    row.className = 'other-cost-row';
                    row.innerHTML = `<input type="text" placeholder="Nome do Custo (ex: Maquininha)"><input type="number" step="0.1" placeholder="%"><button type="button" class="btn btn-danger btn-icon" onclick="this.parentElement.remove(); document.dispatchEvent(new Event('recalculate'));"><i class="ph ph-trash"></i></button>`;
                    otherCostsContainer.appendChild(row);
                });

                document.addEventListener('recalculate', updatePricingCalculator);

                const photoUpload = document.getElementById('product-photo-upload');
                const photoLabel = document.getElementById('product-photo-label');
                photoUpload.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) { const reader = new FileReader(); reader.onload = (event) => { photoLabel.innerHTML = `<img src="${event.target.result}" alt="Pr√©-visualiza√ß√£o do produto">`; }; reader.readAsDataURL(file); }
                });

                let productsData = [{ id: 1, name: 'Bolo de Chocolate', category: 'Bolos', price: 55.00, cost: 25.50, stock: 15 }];
                const stockValueEl = document.getElementById('stock-value-total');
                const profitPotentialEl = document.getElementById('stock-profit-potential');
                const stockQuantityEl = document.getElementById('stock-quantity-total');
                const productsTableBody = document.getElementById('products-table-body');
                function calculateStockSummary() { const v = productsData.reduce((a, p) => a + (p.cost * p.stock), 0); const l = productsData.reduce((a, p) => a + ((p.price - p.cost) * p.stock), 0); const q = productsData.reduce((a, p) => a + p.stock, 0); stockValueEl.textContent = formatCurrency(v); profitPotentialEl.textContent = formatCurrency(l); stockQuantityEl.textContent = q; }
                function renderProducts() { productsTableBody.innerHTML = ''; productsData.forEach(p => { const r = productsTableBody.insertRow(); r.innerHTML = `<td><strong>${p.name}</strong></td><td>${p.category}</td><td>${formatCurrency(p.price)}</td><td>${formatCurrency(p.cost)}</td><td>${p.stock}</td><td class="actions-cell"><button title="Editar"><i class="ph ph-pencil-simple"></i></button><button title="Excluir"><i class="ph ph-trash"></i></button></td>`; }); }
                calculateStockSummary(); renderProducts();
            };
            
            expensesLogic();
            productsLogic();

            console.log('C4 Finan√ßas App Initialized.');
        });
    </script>
</body>
</html>
